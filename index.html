<!DOCTYPE html>
<html lang="vi">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check In - Out</title>

<style>
/* From Uiverse.io by Prakhar227 */ 
.orange {
  color: #caf438;
}

.form-container {
  max-width: 700px;
  margin: 20px auto;
  background-color: #001925;
  padding: 30px;
  border-left: 5px solid #caf438;
  clip-path: polygon(
    0 0,
    100% 0,
    100% calc(100% - 20px),
    calc(100% - 20px) 100%,
    0 100%
  );
}

.heading {
  display: block;
  color: white;
  font-size: 1.5rem;
  font-weight: 800;
  margin-bottom: 20px;
}
.c1 {
  display: block;
  color: #d3f35f;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 20px;
}

.c2 {
  display: block;
  color: white;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 20px;
}

.form-container .form .input {
  color: #87a4b6;
  width: 100%;
  background-color: #002733;
  border: none;
  outline: none;
  padding: 10px;
  margin-bottom: 20px;
  font-weight: bold;
  transition: all 0.2s ease-in-out;
  border-left: 1px solid transparent;
}

.form-container .form .input:focus {
  border-left: 5px solid #caf438;
}

.form-container .form .textarea {
  width: 100%;
  padding: 10px;
  border: none;
  outline: none;
  background-color: #013747;
  color: #caf438;
  font-weight: bold;
  resize: none;
  max-height: 150px;
  margin-bottom: 20px;
  border-left: 1px solid transparent;
  transition: all 0.2s ease-in-out;
}

.form-container .form .textarea:focus {
  border-left: 5px solid #caf438;
}

.form-container .form .button-container {
  display: flex;
  gap: 10px;
}

.form-container .form .button-container .send-button {
  flex-basis: 70%;
  background: #caf438;
  padding: 10px;
  color: #001925;
  text-align: center;
  font-weight: bold;
  border: 1px solid transparent;
  transition: all 0.2s ease-in-out;
}

.form-container .form .button-container .send-button:hover {
  background: transparent;
  border: 1px solid #ff7a01;
  color: #caf438;
}

.form-container .form .button-container .reset-button-container {
  filter: drop-shadow(1px 1px 0px #ff7a01);
  flex-basis: 30%;
}

.form-container .form .button-container .reset-button-container .reset-button {
  position: relative;
  text-align: center;
  padding: 10px;
  color: #caf438;
  font-weight: bold;
  background: #001925;
  clip-path: polygon(
    0 0,
    100% 0,
    100% calc(100% - 10px),
    calc(100% - 10px) 100%,
    0 100%
  );
  transition: all 0.2s ease-in-out;
}

.form-container
  .form
  .button-container
  .reset-button-container
  .reset-button:hover {
  background: #caf438;
  color: #001925;
}
.login-button {
  display: block;
  width: 100%;
  font-weight: bold;
  background: #D3F35F;
  color: black;
  padding-block: 15px;
  margin: 20px auto;
  border: none;
  cursor: pointer;
}


</style>
</head>

<body>

<!-- From Uiverse.io by Prakhar227 --> 
<div class="form-container">
<form class="form" onsubmit="event.preventDefault(); sendData();">

  <div class="form">
    <span class="heading">CHECK IN - OUT</span>
    <span class="c1">CÃ¹ng Ä‘iá»ƒm danh nhÃ©</span>

    <input  required class="input" id="hoten" placeholder="Há» vÃ  tÃªn" />
    <input required id="imageInput" type="file" accept="image/*" capture="camera" class="input">
     <select id="mode" class="input" style="width: 100%;">
      <option value="Online">Online</option>
      <option value="Offline">Offline</option>
    </select>

    <!-- Check-in / Check-out -->
    <select id="statusType" class="input" style="width: 100%;">
      <option value="Check-in">Check-in</option>
      <option value="Check-out">Check-out</option>
    </select>
    <span id="status" class="c2"></span>
    <input class="login-button " type="submit" value="Gá»­i thÃ´ng tin">
    
    </div>
  </div>
  </form>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyneFr9Q3TpB2NZmFwCCrsojNeCTPv9KH0lU-WqD4l_m5xdSEGfGIZ2GtobtkEHULyc/exec";  // ðŸ‘‰ DÃ¡n link /exec vÃ o Ä‘Ã¢y

async function getAddress(lat, lng) {
  try {
    let url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`;
    let res = await fetch(url);
    let data = await res.json();
    return data.display_name || "KhÃ´ng xÃ¡c Ä‘á»‹nh";
  } catch {
    return "KhÃ´ng láº¥y Ä‘Æ°á»£c Ä‘á»‹a chá»‰";
  }
}

async function sendData() {
  let hoten = document.getElementById("hoten").value.trim();
  let mode  = document.getElementById("mode").value;
  let type  = document.getElementById("statusType").value;
  let imgFile = document.getElementById("imageInput").files[0];
  let statusBox = document.getElementById("status");

  if (!hoten) {
    statusBox.innerHTML = "âš  Vui lÃ²ng nháº­p há» tÃªn!";
    statusBox.style.color = "red";
    return;
  }

  statusBox.innerHTML = "â³ Äang láº¥y vá»‹ trÃ­...";
  statusBox.style.color = "#444";

  navigator.geolocation.getCurrentPosition(async pos => {
    let lat = pos.coords.latitude;
    let lng = pos.coords.longitude;

    let address = await getAddress(lat, lng);

    let base64img = "";
    if (imgFile) base64img = await toBase64(imgFile);

    statusBox.innerHTML = "â³ Äang gá»­i dá»¯ liá»‡u...";

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        hoten,
        mode,
        type,
        lat,
        lng,
        address,
        image: base64img
      })
    })
    .then(r => r.json())
    .then(res => {
      statusBox.style.color = "green";
      statusBox.innerHTML = "âœ” Ghi nháº­n thÃ nh cÃ´ng!";
    })
    .catch(err => {
      console.error(err);
      statusBox.style.color = "red";
      statusBox.innerHTML = "âŒ Lá»—i gá»­i dá»¯ liá»‡u!";
    });

  }, err => {
      statusBox.style.color = "red";
      statusBox.innerHTML = "âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c GPS!";
  });
}

// Convert image â†’ Base64
function toBase64(file) {
  return new Promise((resolve, reject) => {
    let reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
</script>

</body>